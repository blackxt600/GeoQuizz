<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoQuizz - Devinez l'emplacement</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Écran de configuration -->
    <div id="config-screen" class="screen active">
        <div class="container">
            <h1>GeoQuizz</h1>
            <p class="subtitle">Devinez l'emplacement des photos</p>

            <div class="config-form">
                <div class="form-group">
                    <label for="player-name">Nom du joueur</label>
                    <input type="text" id="player-name" placeholder="Entrez votre nom" value="Joueur 1">
                </div>

                <div class="form-group">
                    <label for="photo-folder">Dossier des photos</label>
                    <input type="text" id="photo-folder" placeholder="C:\Photos\Vacances">
                    <small>Chemin complet du dossier contenant vos photos avec GPS</small>
                </div>

                <div class="form-group">
                    <label for="num-rounds">Nombre de manches</label>
                    <select id="num-rounds">
                        <option value="3">3 manches</option>
                        <option value="5" selected>5 manches</option>
                        <option value="10">10 manches</option>
                        <option value="15">15 manches</option>
                    </select>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="center-france" checked>
                        Centrer la carte sur la France à chaque manche
                    </label>
                    <small>Facilite la sélection rapide d'un lieu en France</small>
                </div>

                <button id="btn-scan-photos" class="btn btn-primary">Scanner les photos</button>

                <div id="scan-result" class="scan-result hidden">
                    <p class="success"></p>
                    <button id="btn-start-game" class="btn btn-success">Démarrer la partie solo</button>
                    <button id="btn-create-multiplayer" class="btn btn-success">Créer partie multijoueur</button>
                </div>

                <div id="scan-error" class="scan-error hidden"></div>

                <!-- Rejoindre une partie (toujours visible) -->
                <div class="multiplayer-join-section">
                    <hr>
                    <h3>Ou rejoindre une partie existante</h3>
                    <p class="hint">Entrez simplement votre nom et le code de la salle</p>
                    <button id="btn-join-multiplayer" class="btn btn-secondary btn-large">Rejoindre une partie</button>
                </div>
            </div>

            <div class="stats">
                <h3>Statistiques</h3>
                <div id="stats-content">
                    <p>Aucune statistique disponible</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Écran Lobby Multijoueur -->
    <div id="lobby-screen" class="screen">
        <div class="container">
            <h1>Salle Multijoueur</h1>

            <div class="lobby-info">
                <div class="room-code-section">
                    <h3>Code de la salle</h3>
                    <div class="room-code-display">
                        <span id="lobby-room-code">----</span>
                        <button id="btn-copy-code" class="btn btn-small">Copier</button>
                    </div>
                    <p class="hint">Partagez ce code avec vos amis</p>

                    <!-- QR Code Section -->
                    <div class="qr-code-section">
                        <h4>Ou scannez ce QR code</h4>
                        <div id="qr-code-container" class="qr-code-container">
                            <img id="qr-code-image" src="" alt="QR Code de la salle">
                        </div>
                        <div id="share-url-display" class="share-url-display">
                            <small id="share-url-text"></small>
                        </div>
                        <button id="btn-copy-url" class="btn btn-small">Copier le lien</button>
                    </div>
                </div>

                <div class="room-settings">
                    <p><strong>Manches:</strong> <span id="lobby-num-rounds">5</span></p>
                    <p><strong>Timer:</strong> 60 secondes par manche</p>
                    <p><strong>Joueurs:</strong> <span id="lobby-player-count">1</span>/6</p>
                </div>
            </div>

            <div class="players-list">
                <h3>Joueurs</h3>
                <div id="lobby-players-container"></div>
            </div>

            <div class="lobby-actions">
                <button id="btn-ready" class="btn btn-primary">Prêt</button>
                <button id="btn-start-multiplayer" class="btn btn-success" disabled>Démarrer la partie</button>
                <button id="btn-leave-lobby" class="btn btn-secondary">Quitter</button>
            </div>

            <div id="lobby-status" class="lobby-status"></div>
        </div>
    </div>

    <!-- Écran de jeu -->
    <div id="game-screen" class="screen">
        <div class="game-header">
            <!-- Timer (multijoueur uniquement) -->
            <div id="timer-container" class="timer-container hidden">
                <div id="timer-display" class="timer-display">1:00</div>
            </div>

            <!-- Statuts joueurs (multijoueur uniquement) -->
            <div id="players-status-container" class="players-status-container hidden">
                <div id="players-status-list" class="players-status-list"></div>
            </div>

            <!-- Info jeu (solo) -->
            <div class="game-info">
                <span id="player-display"></span>
                <span id="round-display">Manche 1/5</span>
                <span id="score-display">Score: 0</span>
            </div>
        </div>

        <div class="game-content">
            <div class="photo-section">
                <h2>Où se trouve cette photo ?</h2>
                <div class="photo-container">
                    <img id="current-photo" src="" alt="Photo à deviner">
                </div>
            </div>

            <div class="map-section">
                <h2>Cliquez sur la carte pour deviner</h2>
                <div id="map"></div>
                <button id="btn-submit-guess" class="btn btn-primary" disabled>Valider ma réponse</button>
                <div id="waiting-message" class="waiting-message hidden">
                    <p>En attente des autres joueurs...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Écran de résultat -->
    <div id="result-screen" class="screen">
        <div class="container">
            <h2>Résultat de la manche</h2>

            <div class="result-details">
                <div class="result-item">
                    <span class="label">Distance:</span>
                    <span id="result-distance" class="value"></span>
                </div>
                <div class="result-item">
                    <span class="label">Score:</span>
                    <span id="result-score" class="value"></span>
                </div>
                <div class="result-item">
                    <span class="label">Score total:</span>
                    <span id="result-total-score" class="value"></span>
                </div>
            </div>

            <div id="result-map"></div>

            <div class="result-actions">
                <button id="btn-next-round" class="btn btn-primary">Manche suivante</button>
            </div>
        </div>
    </div>

    <!-- Écran de résultats multijoueur -->
    <div id="multiplayer-result-screen" class="screen">
        <div class="container">
            <h2>Résultats de la manche</h2>

            <!-- Leaderboard de la manche -->
            <div class="round-leaderboard">
                <h3>Classement</h3>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rang</th>
                            <th>Joueur</th>
                            <th>Distance</th>
                            <th>Score</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="multiplayer-results-tbody"></tbody>
                </table>
            </div>

            <!-- Carte avec tous les marqueurs -->
            <div class="results-map-section">
                <h3>Vos réponses</h3>
                <div id="multiplayer-result-map"></div>
            </div>

            <div class="result-actions">
                <button id="btn-next-multiplayer-round" class="btn btn-primary">Continuer</button>
            </div>
        </div>
    </div>

    <!-- Écran de fin de partie -->
    <div id="end-screen" class="screen">
        <div class="container">
            <h1>Partie terminée !</h1>

            <div class="final-score">
                <h2>Score final</h2>
                <div class="score-big" id="final-score">0</div>
                <p id="final-player-name"></p>
            </div>

            <div class="summary">
                <h3>Récapitulatif des manches</h3>
                <div id="summary-content"></div>
            </div>

            <div class="leaderboard">
                <h3>Classement</h3>
                <div id="leaderboard-content"></div>
            </div>

            <div class="end-actions">
                <button id="btn-new-game" class="btn btn-primary">Nouvelle partie</button>
                <button id="btn-change-config" class="btn btn-secondary">Changer de configuration</button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
